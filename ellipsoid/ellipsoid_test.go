// These are the 'at' tests from the Geo::Ellipsoid package.
package ellipsoid

import (
	"runtime"
	"strconv"

	"testing"
)
import "math"
import "fmt"

func deltaWithin(test *testing.T, loc string, v float64, t float64, d float64) {
	diff := math.Abs(v - t)
	if diff < d {
		// fmt.Printf("Test OK\n")
	} else {
		test.Errorf("%s FAIL: v - t = %f - %f = %f\n", loc, v, t, diff)
	}
}

func loc() (loc string) {
	_, _, l, _ := runtime.Caller(1)
	return "L" + strconv.Itoa(l)
}

type testobjectAt struct {
	loc  string
	lat1 float64
	lon1 float64
	d    float64 // distance
	b    float64 // bearing
	lat2 float64
	lon2 float64
}

func TestAt(t *testing.T) {

	e1 := Init("WGS84", Degrees, Meter, LongitudeNotSymmetric, BearingNotSymmetric)

	allTestsE1 := []testobjectAt{
		{loc(), -38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, 190.880662670944},
		{loc(), -1.549886, 336.466532, 3150.908018, 129.475800, -1.56800166865689, 336.48838856866},
		{loc(), -11.235004, 282.756437, 1175.174596, 192.154112, -11.2453901777647, 282.754171348951},
		{loc(), -11.919645, 340.641713, 891.615326, 153.274434, -11.9268441615802, 340.645393779515},
		{loc(), -12.674750, 312.909013, 3145.681733, 358.190380, -12.6463295522285, 312.908098770026},
		{loc(), -14.608137, 30.094655, 6390.954467, 5.838786, -14.5506757312212, 30.1006878108632},
		{loc(), -15.074589, 56.914619, 7164.429748, 173.487403, -15.1389196660838, 56.9221791309893},
		{loc(), -17.562152, 276.168590, 5665.575297, 135.075003, -17.5983930208429, 276.206284342329},
		{loc(), -18.084386, 221.381908, 5982.507117, 338.372199, -18.0341383666819, 221.361083689563},
		{loc(), -19.222949, 91.053479, 1338.282294, 224.550018, -19.2315645979899, 91.0445501139712},
		{loc(), -19.715571, 5.847281, 5797.359451, 217.945830, -19.7568659277085, 5.81326755286751},
		{loc(), -20.359063, 296.599967, 1628.799157, 220.382033, -20.3702696544288, 296.589859316515},
		{loc(), -20.725615, 342.386744, 817.492741, 221.236681, -20.7311674916701, 342.381570767838},
		{loc(), -23.824528, 241.336801, 2179.408647, 175.675228, -23.8441499994285, 241.338413904748},
		{loc(), -25.789728, 191.087862, 5544.330184, 5.661707, -25.7399260442896, 191.093313592838},
		{loc(), -26.934636, 30.474042, 991.354098, 72.872537, -26.9320006429192, 30.4835810246334},
		{loc(), -27.100512, 351.279156, 7472.750836, 215.020221, -27.1557353506078, 351.235890988004},
		{loc(), -27.107665, 34.103508, 4111.521802, 243.342905, -27.1243073483822, 34.0664465612592},
		{loc(), -30.360974, 322.538048, 1475.216259, 59.263577, -30.3541720736129, 322.551236568074},
		{loc(), -30.523088, 295.285416, 434.243851, 69.446059, -30.5217130438923, 295.289652469157},
		{loc(), -30.550903, 251.787663, 3538.553197, 192.651457, -30.5820467190056, 251.77958340328},
		{loc(), -33.041308, 313.249683, 9757.188845, 231.280178, -33.0963123185806, 313.168134096477},
		{loc(), -35.454628, 153.274308, 1072.202082, 83.828810, -35.4535887262639, 153.286050580698},
		{loc(), -38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, 190.880662670944},
		{loc(), -4.121498, 262.769582, 9308.966888, 178.488881, -4.205651784836, 262.771793465594},
		{loc(), -4.285155, 344.319438, 2988.101263, 161.216474, -4.31073788511537, 344.328105973954},
		{loc(), -41.090138, 219.595320, 2968.409513, 329.275936, -41.0671591825447, 219.577276687536},
		{loc(), -41.167125, 221.956378, 7772.438867, 65.964741, -41.1385887169891, 222.040925759323},
		{loc(), -41.623677, 208.834416, 1610.051073, 95.264953, -41.6250052190667, 208.853654884741},
		{loc(), -45.137898, 141.541847, 1959.185717, 345.810769, -45.1208065938125, 141.535743596221},
		{loc(), -48.109675, 147.804097, 3851.598342, 313.390029, -48.0858733128975, 147.766528156688},
		{loc(), -5.158991, 259.931626, 4773.871059, 200.977967, -5.19929911014967, 259.916209822012},
		{loc(), -58.652658, 205.140021, 1309.266436, 310.900238, -58.6449608105583, 205.122978574437},
		{loc(), -6.203945, 247.684632, 324.776721, 145.835257, -6.20637500756398, 247.686280489375},
		{loc(), -6.856999, 130.887597, 7763.221087, 214.956451, -6.91453101371976, 130.847349224089},
		{loc(), -60.365048, 156.813021, 10.808349, 186.644917, -60.3651441594277, 156.812997908757},
		{loc(), -61.797586, 265.384439, 9288.961574, 50.299469, -61.7442754682937, 265.519702300482},
		{loc(), -62.773742, 62.342057, 8353.955232, 297.642864, -62.738893257913, 62.197305731553},
		{loc(), -63.553064, 13.025588, 4062.612060, 159.653083, -63.587232627602, 13.0540374200214},
		{loc(), -63.776699, 134.057987, 8903.026576, 322.164617, -63.7135798907925, 133.947510160671},
		{loc(), -64.270514, 45.105873, 5363.627587, 140.110968, -64.3074130400444, 45.1769508481278},
		{loc(), -67.726400, 52.964864, 873.162562, 51.679717, -67.72154487153, 52.9810494838027},
		{loc(), -67.846380, 99.041109, 8317.496525, 12.266233, -67.7735027510774, 99.0829538757835},
		{loc(), -69.865357, 188.114494, 8437.219491, 56.767387, -69.8238139675753, 188.297759634022},
		{loc(), -69.938162, 165.492639, 7837.486006, 155.206150, -70.0019179240387, 165.578716457451},
		{loc(), -7.204161, 179.885067, 2512.365469, 183.789892, -7.22682901108564, 179.883563144484},
		{loc(), -70.362274, 322.490547, 2582.286613, 323.109595, -70.3437578191681, 322.449273778159},
		{loc(), -70.754141, 43.777574, 5605.534780, 236.246900, -70.7820124418521, 43.6507601360177},
		{loc(), -79.523730, 324.065787, 2171.798854, 67.387309, -79.5162359949416, 324.164444728713},
		{loc(), -9.089458, 237.666143, 2239.328571, 14.324009, -9.06984018685994, 237.671182904242},
		{loc(), 0.611947, 100.746342, 9973.981611, 131.132873, 0.55261091016823, 100.813828549171},
		{loc(), 1.348841, 276.378914, 9829.506468, 166.918436, 1.26225340172628, 276.398904775364},
		{loc(), 1.554684, 167.837560, 3131.747930, 59.213013, 1.56918059097552, 167.861737784577},
		{loc(), 11.191046, 106.356107, 4851.812086, 51.506296, 11.2183452049465, 106.390879919224},
		{loc(), 12.921677, 151.249684, 4165.773730, 74.171323, 12.9319448741798, 151.286617723767},
		{loc(), 13.742087, 63.763606, 4388.913613, 181.241894, 13.7024269689814, 63.7627262988153},
		{loc(), 13.769616, 110.113762, 1308.712391, 343.083492, 13.78093309177, 110.110240703272},
		{loc(), 18.396198, 143.265994, 7349.515732, 7.492742, 18.4620306038802, 143.275067859029},
		{loc(), 19.041053, 175.994927, 5177.048787, 281.316611, 19.0502245946019, 175.946699498326},
		{loc(), 19.497371, 220.383733, 5718.963068, 119.960301, 19.4715643857244, 220.430924356231},
		{loc(), 21.323022, 38.682180, 2136.676569, 319.096878, 21.3376068588205, 38.6686929767104},
		{loc(), 22.955732, 47.794852, 8246.705286, 185.066176, 22.8815557299625, 47.7877547716615},
		{loc(), 23.630668, 183.960989, 4996.609275, 55.919867, 23.6559427295585, 184.001554318971},
		{loc(), 25.726049, 310.324628, 6650.414158, 289.782664, 25.7463533347373, 310.262255281203},
		{loc(), 27.335146, 320.699240, 8536.611848, 271.060094, 27.336544790133, 320.612989777828},
		{loc(), 28.972667, 278.549276, 2327.886028, 78.654517, 28.9767972109023, 278.572694719835},
		{loc(), 29.289568, 92.918510, 8113.351247, 35.674974, 29.3490208963828, 92.9672340946057},
		{loc(), 3.076206, 112.117539, 9835.156864, 258.316434, 3.05819117659668, 112.03089587221},
		{loc(), 33.139375, 123.465763, 9357.301964, 74.517011, 33.1618601109721, 123.562433957867},
		{loc(), 34.623205, 31.357288, 7988.594185, 134.837127, 34.5724140545376, 31.4190231012302},
		{loc(), 35.067827, 307.917302, 8369.643934, 170.157432, 34.993494196776, 307.932973187806},
		{loc(), 35.694667, 300.725605, 3436.937434, 117.656799, 35.6802840942486, 300.75923369164},
		{loc(), 40.356751, 153.160097, 5740.614634, 305.081769, 40.3864504304799, 153.104771159051},
		{loc(), 41.911754, 138.151813, 2308.592027, 18.057173, 41.9315142758588, 138.160440601835},
		{loc(), 42.839865, 327.847225, 4283.496948, 308.416746, 42.8638173053354, 327.806155932557},
		{loc(), 44.782374, 163.862303, 9245.465886, 45.480517, 44.8406766505374, 163.945679242349},
		{loc(), 45.339403, 315.409130, 2618.493509, 45.478452, 45.3559203918087, 315.432955775137},
		{loc(), 46.204817, 295.396070, 8211.580529, 221.904425, 46.1498123310369, 295.325077737085},
		{loc(), 46.867006, 44.857631, 9269.632604, 208.315002, 46.7935841133508, 44.8000433688766},
		{loc(), 46.911457, 128.191393, 9713.277037, 65.802158, 46.9472109419573, 128.307769547944},
		{loc(), 5.067958, 24.268528, 8172.788174, 38.204963, 5.12603197726362, 24.3141162471053},
		{loc(), 51.523602, 137.628739, 7272.747263, 125.320332, 51.4857783969849, 137.714167388512},
		{loc(), 54.780139, 8.410011, 9928.854395, 201.999534, 54.6974261720386, 8.3523242715081},
		{loc(), 6.190847, 124.992089, 3854.030593, 133.198367, 6.16698993482276, 125.017473198902},
		{loc(), 6.371687, 279.113190, 364.003776, 337.941402, 6.37473803790458, 279.111954845525},
		{loc(), 6.782845, 255.237805, 3347.905328, 296.785788, 6.79648733577162, 255.21076894319},
		{loc(), 64.324875, 209.104753, 8132.271740, 281.572223, 64.3394159635433, 208.939932681831},
		{loc(), 64.918979, 305.870922, 2833.416804, 309.531171, 64.9351480714201, 305.824710582963},
		{loc(), 66.084685, 30.192264, 1657.534288, 243.904448, 66.0781430272163, 30.1593794067059},
		{loc(), 68.057252, 192.858027, 4711.422894, 252.341167, 68.0444035490457, 192.750473587802},
		{loc(), 68.128342, 115.791221, 4772.498578, 204.791356, 68.0894895788839, 115.743184646015},
		{loc(), 68.994921, 41.466113, 4652.207721, 141.053623, 68.9624691494271, 41.5390782800596},
		{loc(), 7.193705, 159.638737, 3177.227490, 155.223944, 7.16761967835449, 159.650791084088},
		{loc(), 71.112709, 8.834545, 4018.709300, 72.034521, 71.1237884898956, 8.9403714174623},
		{loc(), 72.833548, 317.667505, 62.516492, 29.001224, 72.8340378772457, 317.668425118621},
		{loc(), 74.606774, 294.646962, 7101.250686, 211.655252, 74.552581484185, 294.521662695934},
		{loc(), 74.707726, 290.854396, 7214.189514, 304.432840, 74.7441816240245, 290.651891561222},
		{loc(), 75.481994, 274.248595, 1614.672640, 65.431283, 75.4880029055828, 274.301072964265},
		{loc(), 77.751666, 6.954744, 8617.247199, 43.480525, 77.8075587887118, 7.20615011733763},
		{loc(), 77.940951, 38.523563, 1493.070064, 336.795873, 77.9532419255974, 38.4983240629321}}

	for _, v := range allTestsE1 {
		lat3, lon3 := e1.At(v.lat1, v.lon1, v.d, v.b)
		deltaWithin(t, v.loc, lat3, v.lat2, 1e-1)
		deltaWithin(t, v.loc, lon3, v.lon2, 1e-1)
	}

	e2 := Init("WGS84", Degrees, Meter, LongitudeIsSymmetric, BearingNotSymmetric)

	allTestsE2 := []testobjectAt{
		{loc(), -0.582762, 29.118576, 2946.165884, 106.326170, -0.590251306822743, 29.1439759994689},
		{loc(), -1.549886, 336.466532, 3150.908018, 129.475800, -1.56800166865689, -23.5116114313395},
		{loc(), -11.235004, 282.756437, 1175.174596, 192.154112, -11.2453901777647, -77.2458286510488},
		{loc(), -11.919645, 340.641713, 891.615326, 153.274434, -11.9268441615802, -19.354606220485},
		{loc(), -12.674750, 312.909013, 3145.681733, 358.190380, -12.6463295522285, -47.0919012299736},
		{loc(), -14.608137, 30.094655, 6390.954467, 5.838786, -14.5506757312212, 30.1006878108632},
		{loc(), -15.074589, 56.914619, 7164.429748, 173.487403, -15.1389196660838, 56.9221791309893},
		{loc(), -17.562152, 276.168590, 5665.575297, 135.075003, -17.5983930208429, -83.7937156576705},
		{loc(), -18.084386, 221.381908, 5982.507117, 338.372199, -18.0341383666819, -138.638916310437},
		{loc(), -19.222949, 91.053479, 1338.282294, 224.550018, -19.2315645979899, 91.0445501139712},
		{loc(), -19.715571, 5.847281, 5797.359451, 217.945830, -19.7568659277085, 5.81326755286751},
		{loc(), -20.359063, 296.599967, 1628.799157, 220.382033, -20.3702696544288, -63.4101406834851},
		{loc(), -20.725615, 342.386744, 817.492741, 221.236681, -20.7311674916701, -17.6184292321621},
		{loc(), -23.824528, 241.336801, 2179.408647, 175.675228, -23.8441499994285, -118.661586095252},
		{loc(), -25.789728, 191.087862, 5544.330184, 5.661707, -25.7399260442896, -168.906686407162},
		{loc(), -26.934636, 30.474042, 991.354098, 72.872537, -26.9320006429192, 30.4835810246334},
		{loc(), -27.100512, 351.279156, 7472.750836, 215.020221, -27.1557353506078, -8.76410901199599},
		{loc(), -27.107665, 34.103508, 4111.521802, 243.342905, -27.1243073483822, 34.0664465612592},
		{loc(), -30.360974, 322.538048, 1475.216259, 59.263577, -30.3541720736129, -37.4487634319259},
		{loc(), -30.523088, 295.285416, 434.243851, 69.446059, -30.5217130438923, -64.7103475308431},
		{loc(), -30.550903, 251.787663, 3538.553197, 192.651457, -30.5820467190056, -108.22041659672},
		{loc(), -33.041308, 313.249683, 9757.188845, 231.280178, -33.0963123185806, -46.8318659035227},
		{loc(), -35.454628, 153.274308, 1072.202082, 83.828810, -35.4535887262639, 153.286050580698},
		{loc(), -38.369163, 190.874558, 663.027183, 53.574472, -38.3656166574817, -169.119337329056},
		{loc(), -4.121498, 262.769582, 9308.966888, 178.488881, -4.205651784836, -97.2282065344056},
		{loc(), -4.285155, 344.319438, 2988.101263, 161.216474, -4.31073788511537, -15.6718940260457},
		{loc(), -41.090138, 219.595320, 2968.409513, 329.275936, -41.0671591825447, -140.422723312464},
		{loc(), -41.167125, 221.956378, 7772.438867, 65.964741, -41.1385887169891, -137.959074240677},
		{loc(), -41.623677, 208.834416, 1610.051073, 95.264953, -41.6250052190667, -151.146345115259},
		{loc(), -45.137898, 141.541847, 1959.185717, 345.810769, -45.1208065938125, 141.535743596221},
		{loc(), -48.109675, 147.804097, 3851.598342, 313.390029, -48.0858733128975, 147.766528156688},
		{loc(), -5.158991, 259.931626, 4773.871059, 200.977967, -5.19929911014967, -100.083790177988},
		{loc(), -58.652658, 205.140021, 1309.266436, 310.900238, -58.6449608105583, -154.877021425563},
		{loc(), -6.203945, 247.684632, 324.776721, 145.835257, -6.20637500756398, -112.313719510625},
		{loc(), -6.856999, 130.887597, 7763.221087, 214.956451, -6.91453101371976, 130.847349224089},
		{loc(), -60.365048, 156.813021, 10.808349, 186.644917, -60.3651441594277, 156.812997908757},
		{loc(), -61.797586, 265.384439, 9288.961574, 50.299469, -61.7442754682937, -94.4802976995183},
		{loc(), -62.773742, 62.342057, 8353.955232, 297.642864, -62.738893257913, 62.197305731553},
		{loc(), -63.553064, 13.025588, 4062.612060, 159.653083, -63.587232627602, 13.0540374200214},
		{loc(), -63.776699, 134.057987, 8903.026576, 322.164617, -63.7135798907925, 133.947510160671},
		{loc(), -64.270514, 45.105873, 5363.627587, 140.110968, -64.3074130400444, 45.1769508481278},
		{loc(), -67.726400, 52.964864, 873.162562, 51.679717, -67.72154487153, 52.9810494838027},
		{loc(), -67.846380, 99.041109, 8317.496525, 12.266233, -67.7735027510774, 99.0829538757835},
		{loc(), -69.865357, 188.114494, 8437.219491, 56.767387, -69.8238139675753, -171.702240365978},
		{loc(), -69.938162, 165.492639, 7837.486006, 155.206150, -70.0019179240387, 165.578716457451},
		{loc(), -7.204161, 179.885067, 2512.365469, 183.789892, -7.22682901108564, 179.883563144484},
		{loc(), -70.362274, 322.490547, 2582.286613, 323.109595, -70.3437578191681, -37.5507262218411},
		{loc(), -70.754141, 43.777574, 5605.534780, 236.246900, -70.7820124418521, 43.6507601360177},
		{loc(), -79.523730, 324.065787, 2171.798854, 67.387309, -79.5162359949416, -35.8355552712871},
		{loc(), -9.089458, 237.666143, 2239.328571, 14.324009, -9.06984018685994, -122.328817095758},
		{loc(), 0.611947, 100.746342, 9973.981611, 131.132873, 0.55261091016823, 100.813828549171},
		{loc(), 1.348841, 276.378914, 9829.506468, 166.918436, 1.26225340172628, -83.6010952246363},
		{loc(), 1.554684, 167.837560, 3131.747930, 59.213013, 1.56918059097552, 167.861737784577},
		{loc(), 11.191046, 106.356107, 4851.812086, 51.506296, 11.2183452049465, 106.390879919224},
		{loc(), 12.921677, 151.249684, 4165.773730, 74.171323, 12.9319448741798, 151.286617723767},
		{loc(), 13.742087, 63.763606, 4388.913613, 181.241894, 13.7024269689814, 63.7627262988153},
		{loc(), 13.769616, 110.113762, 1308.712391, 343.083492, 13.78093309177, 110.110240703272},
		{loc(), 18.396198, 143.265994, 7349.515732, 7.492742, 18.4620306038802, 143.275067859029},
		{loc(), 19.041053, 175.994927, 5177.048787, 281.316611, 19.0502245946019, 175.946699498326},
		{loc(), 19.497371, 220.383733, 5718.963068, 119.960301, 19.4715643857244, -139.569075643769},
		{loc(), 21.323022, 38.682180, 2136.676569, 319.096878, 21.3376068588205, 38.6686929767104},
		{loc(), 22.955732, 47.794852, 8246.705286, 185.066176, 22.8815557299625, 47.7877547716615},
		{loc(), 23.630668, 183.960989, 4996.609275, 55.919867, 23.6559427295585, -175.998445681029},
		{loc(), 25.726049, 310.324628, 6650.414158, 289.782664, 25.7463533347373, -49.7377447187972},
		{loc(), 27.335146, 320.699240, 8536.611848, 271.060094, 27.336544790133, -39.3870102221718},
		{loc(), 28.972667, 278.549276, 2327.886028, 78.654517, 28.9767972109023, -81.4273052801652},
		{loc(), 29.289568, 92.918510, 8113.351247, 35.674974, 29.3490208963828, 92.9672340946057},
		{loc(), 3.076206, 112.117539, 9835.156864, 258.316434, 3.05819117659668, 112.03089587221},
		{loc(), 33.139375, 123.465763, 9357.301964, 74.517011, 33.1618601109721, 123.562433957867},
		{loc(), 34.623205, 31.357288, 7988.594185, 134.837127, 34.5724140545376, 31.4190231012302},
		{loc(), 35.067827, 307.917302, 8369.643934, 170.157432, 34.993494196776, -52.0670268121944},
		{loc(), 35.694667, 300.725605, 3436.937434, 117.656799, 35.6802840942486, -59.2407663083597},
		{loc(), 40.356751, 153.160097, 5740.614634, 305.081769, 40.3864504304799, 153.104771159051},
		{loc(), 41.911754, 138.151813, 2308.592027, 18.057173, 41.9315142758588, 138.160440601835},
		{loc(), 42.839865, 327.847225, 4283.496948, 308.416746, 42.8638173053354, -32.1938440674425},
		{loc(), 44.782374, 163.862303, 9245.465886, 45.480517, 44.8406766505374, 163.945679242349},
		{loc(), 45.339403, 315.409130, 2618.493509, 45.478452, 45.3559203918087, -44.5670442248635},
		{loc(), 46.204817, 295.396070, 8211.580529, 221.904425, 46.1498123310369, -64.6749222629154},
		{loc(), 46.867006, 44.857631, 9269.632604, 208.315002, 46.7935841133508, 44.8000433688766},
		{loc(), 46.911457, 128.191393, 9713.277037, 65.802158, 46.9472109419573, 128.307769547944},
		{loc(), 5.067958, 24.268528, 8172.788174, 38.204963, 5.12603197726362, 24.3141162471053},
		{loc(), 51.523602, 137.628739, 7272.747263, 125.320332, 51.4857783969849, 137.714167388512},
		{loc(), 54.780139, 8.410011, 9928.854395, 201.999534, 54.6974261720386, 8.3523242715081},
		{loc(), 6.190847, 124.992089, 3854.030593, 133.198367, 6.16698993482276, 125.017473198902},
		{loc(), 6.371687, 279.113190, 364.003776, 337.941402, 6.37473803790458, -80.8880451544753},
		{loc(), 6.782845, 255.237805, 3347.905328, 296.785788, 6.79648733577162, -104.78923105681},
		{loc(), 64.324875, 209.104753, 8132.271740, 281.572223, 64.3394159635433, -151.060067318169},
		{loc(), 64.918979, 305.870922, 2833.416804, 309.531171, 64.9351480714201, -54.1752894170374},
		{loc(), 66.084685, 30.192264, 1657.534288, 243.904448, 66.0781430272163, 30.1593794067059},
		{loc(), 68.057252, 192.858027, 4711.422894, 252.341167, 68.0444035490457, -167.249526412198},
		{loc(), 68.128342, 115.791221, 4772.498578, 204.791356, 68.0894895788839, 115.743184646015},
		{loc(), 68.994921, 41.466113, 4652.207721, 141.053623, 68.9624691494271, 41.5390782800596},
		{loc(), 7.193705, 159.638737, 3177.227490, 155.223944, 7.16761967835449, 159.650791084088},
		{loc(), 71.112709, 8.834545, 4018.709300, 72.034521, 71.1237884898956, 8.9403714174623},
		{loc(), 72.833548, 317.667505, 62.516492, 29.001224, 72.8340378772457, -42.3315748813785},
		{loc(), 74.606774, 294.646962, 7101.250686, 211.655252, 74.552581484185, -65.4783373040659},
		{loc(), 74.707726, 290.854396, 7214.189514, 304.432840, 74.7441816240245, -69.3481084387778},
		{loc(), 75.481994, 274.248595, 1614.672640, 65.431283, 75.4880029055828, -85.6989270357354},
		{loc(), 77.751666, 6.954744, 8617.247199, 43.480525, 77.8075587887118, 7.20615011733763},
		{loc(), 77.940951, 38.523563, 1493.070064, 336.795873, 77.9532419255974, 38.4983240629321}}

	for _, v := range allTestsE2 {
		lat3, lon3 := e2.At(v.lat1, v.lon1, v.d, v.b)
		deltaWithin(t, v.loc, lat3, v.lat2, 1e-1)
		deltaWithin(t, v.loc, lon3, v.lon2, 1e-1)
	}

}

type testobjectTo struct {
	loc  string
	lat1 float64
	lon1 float64
	lat2 float64
	lon2 float64
	d    float64 // distance
	b    float64 // bearing
	tol  float64 // tolerance
}

func TestTo(t *testing.T) {
	e := Init("WGS84", Degrees, Meter, LongitudeIsSymmetric, BearingNotSymmetric)

	allTests := []testobjectTo{
		{loc(), -88.000000, 1.000000, -88.000000, 1.000000, 0, 0.0, 0.1},
		{loc(), -88.000000, 1.000000, -88.000000, 1.000000, 0, 0, 0.1},
		{loc(), -88.000000, 1.000000, -88.000000, 90.000000, 313115.736403696, 134.482545961512, 0.0001},
		{loc(), -88.000000, 1.000000, -88.000000, 179.000000, 446706.01076052, 178.999390582928, 0.0001},
		{loc(), -88.000000, 1.000000, -88.000000, 268.000000, 324047.278966276, 223.517433140781, 0.0001},
		{loc(), -88.000000, 1.000000, 0.000000, 1.000000, 9778578.68718058, 0, 0.0001},
		{loc(), -88.000000, 1.000000, 0.000000, 90.000000, 9998088.45002268, 89.011158607559, 0.0001},
		{loc(), -88.000000, 1.000000, 0.000000, 179.000000, 10225216.6599337, 177.999150742584, 0.0001},
		{loc(), -88.000000, 1.000000, 0.000000, 268.000000, 10013675.0566307, 266.991287566797, 0.0001},
		{loc(), -88.000000, 1.000000, 88.000000, 1.000000, 19557157.3743612, 0, 0.0001},
		{loc(), -88.000000, 1.000000, 88.000000, 90.000000, 19685321.6740635, 44.5248574511054, 0.0001},
		{loc(), -88.000000, 1.000000, 88.000000, 179.000000, 19996176.9000454, 89.011158607592, 0.0001},
		{loc(), -88.000000, 1.000000, 88.000000, 268.000000, 19696447.0104273, 313.474906296863, 0.0001},
		{loc(), -88.000000, 90.000000, -88.000000, 1.000000, 313115.736403696, 225.517454038488, 0.0001},
		{loc(), -88.000000, 90.000000, -88.000000, 90.000000, 0, 0, 0.1},
		{loc(), -88.000000, 90.000000, -88.000000, 179.000000, 313115.736403696, 134.482545961512, 0.0001},
		{loc(), -88.000000, 90.000000, -88.000000, 268.000000, 446706.01076052, 178.999390582928, 0.0001},
		{loc(), -88.000000, 90.000000, 0.000000, 1.000000, 9998088.45002268, 270.988841392441, 0.0001},
		{loc(), -88.000000, 90.000000, 0.000000, 90.000000, 9778578.68718058, 0, 0.0001},
		{loc(), -88.000000, 90.000000, 0.000000, 179.000000, 9998088.45002268, 89.011158607559, 0.0001},
		{loc(), -88.000000, 90.000000, 0.000000, 268.000000, 10225216.6599337, 177.999150742584, 0.0001},
		{loc(), -88.000000, 90.000000, 88.000000, 1.000000, 19685321.6740635, 315.475142548895, 0.0001},
		{loc(), -88.000000, 90.000000, 88.000000, 90.000000, 19557157.3743612, 0, 0.0001},
		{loc(), -88.000000, 90.000000, 88.000000, 179.000000, 19685321.6740635, 44.5248574511054, 0.0001},
		{loc(), -88.000000, 90.000000, 88.000000, 268.000000, 19996176.9000454, 89.011158607592, 0.0001},
		{loc(), -88.000000, 179.000000, -88.000000, 1.000000, 446706.01076052, 181.000609417072, 0.0001},
		{loc(), -88.000000, 179.000000, -88.000000, 90.000000, 313115.736403696, 225.517454038488, 0.0001},
		{loc(), -88.000000, 179.000000, -88.000000, 179.000000, 0.0, 0, 0.1},
		{loc(), -88.000000, 179.000000, -88.000000, 268.000000, 313115.736403696, 134.482545961512, 0.0001},
		{loc(), -88.000000, 179.000000, 0.000000, 1.000000, 10225216.6599337, 182.000849257416, 0.0001},
		{loc(), -88.000000, 179.000000, 0.000000, 90.000000, 9998088.45002268, 270.988841392441, 0.0001},
		{loc(), -88.000000, 179.000000, 0.000000, 179.000000, 9778578.68718058, 0, 0.0001},
		{loc(), -88.000000, 179.000000, 0.000000, 268.000000, 9998088.45002268, 89.011158607559, 0.0001},
		{loc(), -88.000000, 179.000000, 88.000000, 1.000000, 19996176.9000454, 270.988841392408, 0.0001},
		{loc(), -88.000000, 179.000000, 88.000000, 90.000000, 19685321.6740635, 315.475142548895, 0.0001},
		{loc(), -88.000000, 179.000000, 88.000000, 179.000000, 19557157.3743612, 0, 0.0001},
		{loc(), -88.000000, 179.000000, 88.000000, 268.000000, 19685321.6740635, 44.5248574511054, 0.0001},
		{loc(), -88.000000, 268.000000, -88.000000, 1.000000, 324047.278966276, 136.482566859219, 0.0001},
		{loc(), -88.000000, 268.000000, -88.000000, 90.000000, 446706.01076052, 181.000609417072, 0.0001},
		{loc(), -88.000000, 268.000000, -88.000000, 179.000000, 313115.736403696, 225.517454038488, 0.0001},
		{loc(), -88.000000, 268.000000, -88.000000, 268.000000, 0.0, 0, 0.1},
		{loc(), -88.000000, 268.000000, 0.000000, 1.000000, 10013675.0566307, 93.0087124332033, 0.0001},
		{loc(), -88.000000, 268.000000, 0.000000, 90.000000, 10225216.6599337, 182.000849257416, 0.0001},
		{loc(), -88.000000, 268.000000, 0.000000, 179.000000, 9998088.45002268, 270.988841392441, 0.0001},
		{loc(), -88.000000, 268.000000, 0.000000, 268.000000, 9778578.68718058, 0, 0.0001},
		{loc(), -88.000000, 268.000000, 88.000000, 1.000000, 19696447.0104273, 46.5250937031367, 0.0001},
		{loc(), -88.000000, 268.000000, 88.000000, 90.000000, 19996176.9000454, 270.988841392408, 0.0001},
		{loc(), -88.000000, 268.000000, 88.000000, 179.000000, 19685321.6740635, 315.475142548895, 0.0001},
		{loc(), -88.000000, 268.000000, 88.000000, 268.000000, 19557157.3743612, 0, 0.0001},
		{loc(), 0.000000, 1.000000, -88.000000, 1.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 0.000000, 1.000000, -88.000000, 90.000000, 9998088.45002268, 177.99357628514, 0.0001},
		{loc(), 0.000000, 1.000000, -88.000000, 179.000000, 10225216.6599337, 179.929950967799, 0.0001},
		{loc(), 0.000000, 1.000000, -88.000000, 268.000000, 10013675.0566307, 182.003955421895, 0.0001},
		{loc(), 0.000000, 1.000000, 0.000000, 1.000000, 0.0, 0, 0.1},
		{loc(), 0.000000, 1.000000, 0.000000, 90.000000, 9907434.68060135, 90, 0.0001},
		{loc(), 0.000000, 1.000000, 0.000000, 179.000000, 19814869.3612027, 90, 0.0001},
		{loc(), 0.000000, 1.000000, 0.000000, 268.000000, 10352712.6437744, 270, 0.0001},
		{loc(), 0.000000, 1.000000, 88.000000, 1.000000, 9778578.68718058, 0, 0.0001},
		{loc(), 0.000000, 1.000000, 88.000000, 90.000000, 9998088.45002268, 2.00642371485969, 0.0001},
		{loc(), 0.000000, 1.000000, 88.000000, 179.000000, 10225216.6599337, 0.0700490322014982, 0.0001},
		{loc(), 0.000000, 1.000000, 88.000000, 268.000000, 10013675.0566307, 357.996044578105, 0.0001},
		{loc(), 0.000000, 90.000000, -88.000000, 1.000000, 9998088.45002268, 182.00642371486, 0.0001},
		{loc(), 0.000000, 90.000000, -88.000000, 90.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 0.000000, 90.000000, -88.000000, 179.000000, 9998088.45002268, 177.99357628514, 0.0001},
		{loc(), 0.000000, 90.000000, -88.000000, 268.000000, 10225216.6599337, 179.929950967799, 0.0001},
		{loc(), 0.000000, 90.000000, 0.000000, 1.000000, 9907434.68060135, 270, 0.0001},
		{loc(), 0.000000, 90.000000, 0.000000, 90.000000, 0.0, 0, 0.1},
		{loc(), 0.000000, 90.000000, 0.000000, 179.000000, 9907434.68060135, 90, 0.0001},
		{loc(), 0.000000, 90.000000, 0.000000, 268.000000, 19814869.3612027, 90, 0.0001},
		{loc(), 0.000000, 90.000000, 88.000000, 1.000000, 9998088.45002268, 357.99357628514, 0.0001},
		{loc(), 0.000000, 90.000000, 88.000000, 90.000000, 9778578.68718058, 0, 0.0001},
		{loc(), 0.000000, 90.000000, 88.000000, 179.000000, 9998088.45002268, 2.00642371485969, 0.0001},
		{loc(), 0.000000, 90.000000, 88.000000, 268.000000, 10225216.6599337, 0.0700490322014982, 0.0001},
		{loc(), 0.000000, 179.000000, -88.000000, 1.000000, 10225216.6599337, 180.070049032201, 0.0001},
		{loc(), 0.000000, 179.000000, -88.000000, 90.000000, 9998088.45002268, 182.00642371486, 0.0001},
		{loc(), 0.000000, 179.000000, -88.000000, 179.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 0.000000, 179.000000, -88.000000, 268.000000, 9998088.45002268, 177.99357628514, 0.0001},
		{loc(), 0.000000, 179.000000, 0.000000, 1.000000, 19814869.3612027, 270, 0.0001},
		{loc(), 0.000000, 179.000000, 0.000000, 90.000000, 9907434.68060135, 270, 0.0001},
		{loc(), 0.000000, 179.000000, 0.000000, 179.000000, 0.0, 0, 0.1},
		{loc(), 0.000000, 179.000000, 0.000000, 268.000000, 9907434.68060135, 90, 0.0001},
		{loc(), 0.000000, 179.000000, 88.000000, 1.000000, 10225216.6599337, 359.929950967799, 0.0001},
		{loc(), 0.000000, 179.000000, 88.000000, 90.000000, 9998088.45002268, 357.99357628514, 0.0001},
		{loc(), 0.000000, 179.000000, 88.000000, 179.000000, 9778578.68718058, 0, 0.0001},
		{loc(), 0.000000, 179.000000, 88.000000, 268.000000, 9998088.45002268, 2.00642371485969, 0.0001},
		{loc(), 0.000000, 268.000000, -88.000000, 1.000000, 10013675.0566307, 177.996044578105, 0.0001},
		{loc(), 0.000000, 268.000000, -88.000000, 90.000000, 10225216.6599337, 180.070049032201, 0.0001},
		{loc(), 0.000000, 268.000000, -88.000000, 179.000000, 9998088.45002268, 182.00642371486, 0.0001},
		{loc(), 0.000000, 268.000000, -88.000000, 268.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 0.000000, 268.000000, 0.000000, 1.000000, 10352712.6437744, 90, 0.0001},
		{loc(), 0.000000, 268.000000, 0.000000, 90.000000, 19814869.3612027, 270, 0.0001},
		{loc(), 0.000000, 268.000000, 0.000000, 179.000000, 9907434.68060135, 270, 0.0001},
		{loc(), 0.000000, 268.000000, 0.000000, 268.000000, 0.0, 0, 0.1},
		{loc(), 0.000000, 268.000000, 88.000000, 1.000000, 10013675.0566307, 2.00395542189512, 0.0001},
		{loc(), 0.000000, 268.000000, 88.000000, 90.000000, 10225216.6599337, 359.929950967799, 0.0001},
		{loc(), 0.000000, 268.000000, 88.000000, 179.000000, 9998088.45002268, 357.99357628514, 0.0001},
		{loc(), 0.000000, 268.000000, 88.000000, 268.000000, 9778578.68718058, 0, 0.0001},
		{loc(), 88.000000, 1.000000, -88.000000, 1.000000, 19557157.3743612, 180, 0.0001},
		{loc(), 88.000000, 1.000000, -88.000000, 90.000000, 19685321.6740635, 135.475142548896, 0.0001},
		{loc(), 88.000000, 1.000000, -88.000000, 179.000000, 19996176.9000454, 90.9888413924734, 0.0001},
		{loc(), 88.000000, 1.000000, -88.000000, 268.000000, 19696447.0104273, 226.525093703136, 0.0001},
		{loc(), 88.000000, 1.000000, 0.000000, 1.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 88.000000, 1.000000, 0.000000, 90.000000, 9998088.45002268, 90.988841392441, 0.0001},
		{loc(), 88.000000, 1.000000, 0.000000, 179.000000, 10225216.6599337, 2.00084925741569, 0.0001},
		{loc(), 88.000000, 1.000000, 0.000000, 268.000000, 10013675.0566307, 273.008712433203, 0.0001},
		{loc(), 88.000000, 1.000000, 88.000000, 1.000000, 0.0, 0, 0.1},
		{loc(), 88.000000, 1.000000, 88.000000, 90.000000, 313115.736403702, 45.5174540384878, 0.0001},
		{loc(), 88.000000, 1.000000, 88.000000, 179.000000, 446706.010760529, 1.00060941707181, 0.0001},
		{loc(), 88.000000, 1.000000, 88.000000, 268.000000, 324047.278966282, 316.482566859219, 0.0001},
		{loc(), 88.000000, 90.000000, -88.000000, 1.000000, 19685321.6740635, 224.524857451104, 0.0001},
		{loc(), 88.000000, 90.000000, -88.000000, 90.000000, 19557157.3743612, 180, 0.0001},
		{loc(), 88.000000, 90.000000, -88.000000, 179.000000, 19685321.6740635, 135.475142548896, 0.0001},
		{loc(), 88.000000, 90.000000, -88.000000, 268.000000, 19996176.9000454, 90.9888413924734, 0.0001},
		{loc(), 88.000000, 90.000000, 0.000000, 1.000000, 9998088.45002268, 269.011158607559, 0.0001},
		{loc(), 88.000000, 90.000000, 0.000000, 90.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 88.000000, 90.000000, 0.000000, 179.000000, 9998088.45002268, 90.988841392441, 0.0001},
		{loc(), 88.000000, 90.000000, 0.000000, 268.000000, 10225216.6599337, 2.00084925741569, 0.0001},
		{loc(), 88.000000, 90.000000, 88.000000, 1.000000, 313115.736403702, 314.482545961512, 0.0001},
		{loc(), 88.000000, 90.000000, 88.000000, 90.000000, 0.0, 0, 0.1},
		{loc(), 88.000000, 90.000000, 88.000000, 179.000000, 313115.736403702, 45.5174540384878, 0.0001},
		{loc(), 88.000000, 90.000000, 88.000000, 268.000000, 446706.010760529, 1.00060941707181, 0.0001},
		{loc(), 88.000000, 179.000000, -88.000000, 1.000000, 19996176.9000454, 269.011158607527, 0.0001},
		{loc(), 88.000000, 179.000000, -88.000000, 90.000000, 19685321.6740635, 224.524857451104, 0.0001},
		{loc(), 88.000000, 179.000000, -88.000000, 179.000000, 19557157.3743612, 180, 0.0001},
		{loc(), 88.000000, 179.000000, -88.000000, 268.000000, 19685321.6740635, 135.475142548896, 0.0001},
		{loc(), 88.000000, 179.000000, 0.000000, 1.000000, 10225216.6599337, 357.999150742584, 0.0001},
		{loc(), 88.000000, 179.000000, 0.000000, 90.000000, 9998088.45002268, 269.011158607559, 0.0001},
		{loc(), 88.000000, 179.000000, 0.000000, 179.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 88.000000, 179.000000, 0.000000, 268.000000, 9998088.45002268, 90.988841392441, 0.0001},
		{loc(), 88.000000, 179.000000, 88.000000, 1.000000, 446706.010760529, 358.999390582928, 0.0001},
		{loc(), 88.000000, 179.000000, 88.000000, 90.000000, 313115.736403702, 314.482545961512, 0.0001},
		{loc(), 88.000000, 179.000000, 88.000000, 179.000000, 0.0, 0, 0.1},
		{loc(), 88.000000, 179.000000, 88.000000, 268.000000, 313115.736403702, 45.5174540384878, 0.0001},
		{loc(), 88.000000, 268.000000, -88.000000, 1.000000, 19696447.0104273, 133.474906296864, 0.0001},
		{loc(), 88.000000, 268.000000, -88.000000, 90.000000, 19996176.9000454, 269.011158607527, 0.0001},
		{loc(), 88.000000, 268.000000, -88.000000, 179.000000, 19685321.6740635, 224.524857451104, 0.0001},
		{loc(), 88.000000, 268.000000, -88.000000, 268.000000, 19557157.3743612, 180, 0.0001},
		{loc(), 88.000000, 268.000000, 0.000000, 1.000000, 10013675.0566307, 86.9912875667967, 0.0001},
		{loc(), 88.000000, 268.000000, 0.000000, 90.000000, 10225216.6599337, 357.999150742584, 0.0001},
		{loc(), 88.000000, 268.000000, 0.000000, 179.000000, 9998088.45002268, 269.011158607559, 0.0001},
		{loc(), 88.000000, 268.000000, 0.000000, 268.000000, 9778578.68718058, 180, 0.0001},
		{loc(), 88.000000, 268.000000, 88.000000, 1.000000, 324047.278966282, 43.5174331407808, 0.0001},
		{loc(), 88.000000, 268.000000, 88.000000, 90.000000, 446706.010760529, 358.999390582928, 0.0001},
		{loc(), 88.000000, 268.000000, 88.000000, 179.000000, 313115.736403702, 314.482545961512, 0.0001},
		{loc(), 88.000000, 268.000000, 88.000000, 268.000000, 0.0, 0, 0.1},
		{loc(), -57.934266, 269.464909, -71.038589, 313.367482, 2478983.26981422, 143.395603607968, 0.0001},
		{loc(), 13.605417, 282.316135, 33.826171, 132.755857, 13850451.7048934, 329.412475743044, 0.0001},
		{loc(), 65.807118, 267.744045, -9.495920, 127.342153, 13064794.3870629, 314.966396589062, 0.0001},
		{loc(), 40.923455, 94.159476, -18.604296, 279.644382, 17475952.9859877, 346.682016294252, 0.0001},
		{loc(), 60.726184, 207.132176, 37.934793, 29.881529, 9065819.55603936, 357.809015839191, 0.0001},
		{loc(), -7.774777, 40.360959, 7.960132, 140.647165, 11262132.6431769, 83.4278273130909, 0.0001},
		{loc(), 12.071034, 344.345789, 64.718561, 58.748224, 8059002.00518262, 25.6350676733314, 0.0001},
		{loc(), -39.510429, 94.209272, 74.640675, 156.932149, 13463843.6928142, 16.0430701128036, 0.0001},
		{loc(), 50.945112, 46.686892, -73.531799, 338.631126, 14726732.6094757, 201.007479159506, 0.0001},
		{loc(), -83.498813, 56.207513, -20.735893, 55.705212, 6982046.80533501, 359.4713992725, 0.0001},
		{loc(), 5.162682, 314.911760, -12.212387, 95.006241, 15580306.134578, 102.90535353589, 0.0001},
		{loc(), -32.807368, 276.692824, -69.099205, 277.575212, 4037491.56639158, 179.466380802463, 0.0001},
		{loc(), 36.114418, 79.272998, 46.075743, 148.216696, 5712966.86704551, 56.1362395061731, 0.0001},
		{loc(), 26.193521, 333.924339, 0.425668, 247.478645, 9639530.83300946, 268.930507164728, 0.0001},
		{loc(), -11.247993, 218.771725, 13.474320, 227.743816, 2908081.0984665, 20.1557316624214, 0.0001},
		{loc(), -6.437086, 227.343277, -63.660092, 345.874110, 10716663.132942, 156.867043901473, 0.0001},
		{loc(), -62.590000, 160.912539, -30.873135, 342.930268, 9642768.3047107, 181.732680684942, 0.0001},
		{loc(), -24.959632, 143.558544, -70.174449, 343.830865, 9331596.49998794, 186.797641578604, 0.0001},
		{loc(), 85.292583, 207.197289, 64.400817, 53.955321, 3334743.62344139, 337.012768638466, 0.0001},
		{loc(), 72.010476, 234.148398, -76.760490, 343.799779, 17966012.0923903, 136.471695744589, 0.0001},
		{loc(), 82.062247, 282.224532, 53.709008, 205.651325, 3925232.39059218, 267.548713448222, 0.0001},
		{loc(), -38.264913, 345.593277, 13.987962, 157.269106, 17193609.7687517, 161.114003589302, 0.0001},
		{loc(), -21.923233, 331.579924, -82.948909, 276.789592, 7136933.98147936, 186.41943112575, 0.0001},
		{loc(), 39.266792, 212.567027, -13.043617, 231.171501, 6104433.98020838, 157.632255571465, 0.0001},
		{loc(), 43.430240, 25.708641, -78.620089, 278.752912, 15067414.5790259, 195.703317974022, 0.0001},
		{loc(), 35.816613, 44.413390, -34.595103, 26.822827, 8006275.94631107, 195.212777836564, 0.0001},
		{loc(), 33.063322, 131.654287, 40.382161, 70.051002, 5452116.89026308, 297.235375347757, 0.0001},
		{loc(), -60.791775, 58.921675, 58.472988, 198.337306, 17744632.7153385, 78.646083333167, 0.0001},
		{loc(), -32.182827, 189.929621, -11.752936, 76.924247, 11405061.5799716, 247.228653711236, 0.0001},
		{loc(), 40.410413, 1.490210, 15.171991, 171.877678, 13771611.4326195, 11.1215097915429, 0.0001},
		{loc(), 77.415003, 273.852765, -65.518823, 5.320166, 16984526.9730499, 114.317943803113, 0.0001},
		{loc(), -0.001169, 303.428210, 61.978146, 32.763058, 9970926.02740749, 28.100737553144, 0.0001},
		{loc(), 62.964471, 283.438450, 13.811810, 35.816077, 9733041.79438803, 63.9173979767126, 0.0001},
		{loc(), 57.757522, 268.496370, 71.873398, 184.371272, 3887427.27158255, 327.17462331126, 0.0001},
		{loc(), 67.683592, 345.377181, 11.705901, 170.600523, 11188758.804159, 354.806955928828, 0.0001},
		{loc(), -14.509993, 233.823561, 66.915477, 210.936486, 9223027.54994791, 351.122612522391, 0.0001},
		{loc(), -48.837869, 358.766092, -59.984409, 250.415053, 6331138.72714117, 214.601548309314, 0.0001},
		{loc(), 35.469166, 354.061624, 26.153177, 235.757036, 10606793.2549714, 307.54615644259, 0.0001},
		{loc(), 60.579911, 245.073600, 82.746095, 119.397052, 3807870.32524918, 349.456168279081, 0.0001},
		{loc(), 52.814462, 58.052386, 63.937125, 216.992405, 6929484.96260079, 10.2919524401595, 0.0001},
		{loc(), -14.087235, 352.325834, 64.925852, 167.053343, 14344572.4591005, 2.87132324469977, 0.0001},
		{loc(), -44.555528, 303.380598, 60.410717, 265.142366, 12142365.0295713, 341.013133837574, 0.0001},
		{loc(), -64.733717, 171.696178, 50.043309, 179.133361, 12743611.5768642, 5.27317915617838, 0.0001},
		{loc(), 12.112040, 159.973637, -81.799749, 119.465377, 10640434.6234949, 185.36408498589, 0.0001},
		{loc(), -12.913136, 209.560123, -72.500921, 242.959763, 6973908.49631601, 169.226215342821, 0.0001},
		{loc(), 15.388763, 85.383404, 43.057681, 345.007357, 9674590.63953447, 313.920881630087, 0.0001},
		{loc(), 64.108958, 27.645978, 7.006558, 137.813405, 10265664.1927237, 68.7123060867185, 0.0001},
		{loc(), -87.675134, 257.547959, -78.556203, 7.576067, 1388279.96503049, 120.008321576532, 0.0001},
		{loc(), 45.506762, 226.167856, 75.858502, 197.258652, 3642825.04801401, 347.342287196448, 0.0001},
		{loc(), -15.130062, 141.680058, -53.226032, 110.910346, 5012011.5716539, 205.717239120564, 0.0001},
		{loc(), -51.171998, 219.770710, -22.538592, 57.834091, 11650461.6034958, 197.174001590393, 0.0001},
		{loc(), -7.000668, 288.466856, -55.716970, 258.457540, 6017359.40295353, 200.419276815272, 0.0001},
		{loc(), -4.103181, 51.748045, 23.523933, 87.322753, 4923654.59463329, 49.9333838628388, 0.0001},
		{loc(), -66.149558, 312.989638, -69.799797, 271.586522, 1743562.46751605, 238.030177426519, 0.0001},
		{loc(), -21.017857, 200.311309, -74.230046, 135.855002, 7005716.26957978, 196.029492653125, 0.0001},
		{loc(), 22.032424, 283.684581, -13.840647, 296.727744, 4215876.49472136, 159.073330859259, 0.0001},
		{loc(), 9.137311, 261.695802, -1.968743, 94.386354, 18415518.434645, 299.740904431686, 0.0001},
		{loc(), -0.367684, 176.265124, -1.495746, 305.845852, 14421564.897997, 92.2533762539934, 0.0001},
		{loc(), 73.726080, 130.581316, 8.059198, 217.631502, 9055964.88324431, 90.4838402750219, 0.0001},
		{loc(), 19.299877, 158.813658, 36.382896, 77.814439, 7978668.24478752, 303.044909439054, 0.0001},
		{loc(), 46.759530, 110.686586, 50.379077, 32.324924, 5522070.40672904, 304.786480351645, 0.0001},
		{loc(), 70.152840, 335.224848, 82.259265, 222.676574, 2664806.26132369, 342.089448894924, 0.0001},
		{loc(), -76.222244, 41.464968, 22.995327, 26.717480, 11054300.8320442, 346.229809972732, 0.0001},
		{loc(), 10.103669, 84.844998, 19.705372, 336.438821, 11523412.006604, 293.284547184865, 0.0001},
		{loc(), 12.619602, 206.584638, -6.260003, 43.507509, 18046314.1453549, 289.873007821456, 0.0001},
		{loc(), -46.431748, 358.501506, 10.070717, 310.960507, 7840004.49282381, 309.499327919992, 0.0001},
		{loc(), -37.466916, 262.319964, 56.541387, 175.943954, 13175801.2840537, 321.047143676273, 0.0001},
		{loc(), 16.376357, 41.153536, -60.139286, 251.664078, 14563419.7032954, 199.553357833555, 0.0001},
		{loc(), 16.688504, 317.111550, -12.125937, 75.628131, 13409094.6209134, 94.363475724486, 0.0001},
		{loc(), -55.936936, 247.119658, -49.609989, 95.206424, 8019595.70546293, 198.711523711379, 0.0001},
		{loc(), -48.734356, 177.370827, -40.864142, 160.579825, 1585126.11176859, 297.197389057407, 0.0001},
		{loc(), -46.420266, 107.250326, 26.510982, 269.915143, 17322878.3638282, 139.796923668858, 0.0001},
		{loc(), 33.895806, 153.110909, 45.681845, 143.422437, 1546932.16434011, 330.633136925071, 0.0001},
		{loc(), -22.177541, 230.512649, 5.952076, 323.707746, 10591953.1790129, 85.7970967849502, 0.0001},
		{loc(), 27.348830, 334.178805, -86.270375, 62.080991, 13006113.218666, 175.799365534158, 0.0001},
		{loc(), 25.235341, 275.242036, 31.035045, 277.375893, 676004.612711586, 17.5689229834593, 0.0001},
		{loc(), 44.964609, 321.744934, -49.665325, 229.175856, 13769363.5529944, 231.396822356016, 0.0001},
		{loc(), 17.105270, 223.789909, -23.725503, 25.530801, 17989959.0909754, 114.55421109574, 0.0001},
		{loc(), -43.562030, 130.274241, -2.881152, 181.334105, 6743615.83724109, 63.1354501704683, 0.0001},
		{loc(), -36.975702, 86.458774, 28.597533, 323.170028, 14709618.4240825, 276.991231019081, 0.0001},
		{loc(), 30.175209, 16.459075, 59.419522, 205.929510, 10036719.5388652, 355.197249821978, 0.0001},
		{loc(), -55.644950, 10.465550, -4.344329, 202.739897, 13260281.1799076, 194.001768323124, 0.0001},
		{loc(), -58.450106, 219.537369, 25.011231, 110.301202, 13454859.3055112, 267.595411116428, 0.0001},
		{loc(), 80.393984, 275.211192, 23.935568, 24.731901, 7745665.22175974, 66.7895730503046, 0.0001},
		{loc(), -65.005040, 272.050479, -3.463969, 257.290127, 6929926.85789333, 343.292530540849, 0.0001},
		{loc(), -67.713271, 230.359203, -17.890516, 254.265464, 5790460.28705559, 29.3042376067398, 0.0001},
		{loc(), 49.977476, 253.413450, -40.736808, 280.971459, 10404674.0369978, 159.351345995222, 0.0001},
		{loc(), -64.390959, 100.137796, -73.699237, 76.773535, 1377371.39603648, 211.403175640332, 0.0001},
		{loc(), -53.488147, 222.676284, 18.783198, 197.750208, 8357066.17548392, 335.565188497479, 0.0001},
		{loc(), 11.886353, 45.880034, -75.325990, 317.821511, 11219022.8120392, 194.994234182454, 0.0001},
		{loc(), -61.023376, 203.548199, -32.274576, 120.526333, 6560175.49592739, 258.557806173273, 0.0001},
		{loc(), -51.815775, 243.103403, -81.006002, 15.254084, 4980459.53607217, 170.496737342413, 0.0001},
		{loc(), 55.609307, 24.137667, 36.573196, 147.424699, 8467114.65823862, 43.7496416993868, 0.0001},
		{loc(), 68.261410, 337.404883, -87.468266, 126.278650, 17814444.0832232, 176.099040884626, 0.0001},
		{loc(), 77.163243, 355.929440, -24.865636, 351.624329, 11323314.1064423, 183.999262418074, 0.0001},
		{loc(), -83.363412, 123.109687, 60.930467, 157.757983, 16129090.5382028, 29.0390517827566, 0.0001},
		{loc(), 35.819668, 205.275583, -69.790147, 65.110415, 15535352.6980755, 200.069364324033, 0.0001},
		{loc(), -45.720757, 245.961448, 85.378805, 184.898940, 14801887.1990009, 354.425186265008, 0.0001},
		{loc(), 70.557651, 168.120919, -4.512946, 146.711647, 8481627.39707062, 202.024485782197, 0.0001},
		{loc(), 45.494490, 42.178744, -62.327500, 251.688039, 17356605.1087735, 214.442967212505, 0.0001}}

	for _, v := range allTests {
		dist, bear := e.To(v.lat1, v.lon1, v.lat2, v.lon2)
		deltaWithin(t, v.loc, dist, v.d, 1e-1)
		deltaWithin(t, v.loc, bear, v.b, v.tol)
	}
}

type testobjectAirport struct {
	loc   string
	t     string
	lat1  float64
	lon1  float64
	lat2  float64
	lon2  float64
	delta float64
}

func testAirport(t *testing.T) {
	epsilon := 50.0
	allTests := []testobjectAirport{
		{loc(), "Istanbul to Delhi", 41.1, 29, 28.67, 77.21, 4550},
		{loc(), "Tokyo to Newyork", 35.67, 139.77, 40.67, -73.94, 10846},
		{loc(), "Lima to Cairo", -12.07, -77.05, 30.06, 31.25, 12423},
		{loc(), "Lahore to RiodeJaneiro", 31.56, 74.35, -22.91, -43.2, 13845},
		{loc(), "Santiago to Kaifeng", 19.48, -70.69, 34.85, 114.35, 19529},
		{loc(), "Calcutta to Toronto", 22.57, 88.36, 43.65, -79.38, 12540},
		{loc(), "Rangoon to Sydney", 16.79, 96.15, -33.87, 151.21, 8104},
		{loc(), "Madras to Riyadh", 13.09, 80.27, 24.65, 46.77, 3739},
		{loc(), "Chongqing to Chengdu", 29.57, 106.58, 30.67, 104.07, 268},
		{loc(), "Tianjin to Melbourne", 39.13, 117.2, -37.81, 144.96, 9015},
		{loc(), "Pusan to Abidjan", 35.11, 129.03, 5.33, -4.03, 13362},
		{loc(), "Yokohama to Ibadan", 35.47, 139.62, 7.38, 3.93, 13373},
		{loc(), "Singapore to Ankara", 1.3, 103.85, 39.93, 32.85, 8303},
		{loc(), "Berlin to Montreal", 52.52, 13.38, 45.52, -73.57, 6001},
		{loc(), "Pyongyang to Lanzhou", 39.02, 125.75, 36.05, 103.68, 1959},
		{loc(), "Guangzhou to Casablanca", 23.12, 113.25, 33.6, -7.62, 11132},
		{loc(), "Durban to Madrid", -29.87, 30.99, 40.42, -3.71, 8593},
		{loc(), "Nanjing to Kabul", 32.05, 118.78, 34.53, 69.17, 4571},
		{loc(), "Pune to Surat", 18.53, 73.84, 21.2, 72.82, 312},
		{loc(), "Jiddah to Chicago", 21.5, 39.17, 41.84, -87.68, 11102},
		{loc(), "Kanpur to Luanda", 26.47, 80.33, -8.82, 13.24, 8228},
		{loc(), "Taiyuan to Salvador", 37.87, 112.55, -12.97, -38.5, 16033},
		{loc(), "Taegu to Rome", 35.87, 128.6, 41.89, 12.5, 9202},
		{loc(), "Changchun to Kiev", 43.87, 125.35, 50.43, 30.52, 6701},
		{loc(), "Faisalabad to Izmir", 31.41, 73.11, 38.43, 27.15, 4215}}

	e := Init("WGS84", Degrees, Kilometer, LongitudeIsSymmetric, BearingIsSymmetric)
	for i, v := range allTests {
		fmt.Printf("Going from %v\n", v.t)
		r, _ := e.To(v.lat1, v.lon1, v.lat2, v.lon2)
		fmt.Printf("Going from %v %v \n", v.delta, r)
		deltaWithin(t, v.loc, r, v.delta, epsilon)
		fmt.Printf("END %v \n", i)
	}
}

func TestToLLA(t *testing.T) {

	e1 := Init("WGS84", Degrees, Meter, LongitudeIsSymmetric, BearingNotSymmetric)
	//  http://sysense.net/products/ecef_lla_converter/index.html
	allTests := []testobjecttoECEF{
		{loc(), 30.2746722, -97.7403306, 0.0, -742507.1, -5462738.5, 3196706.5},
		{loc(), 38.649882, -77.134602, -3261.28, 1110000., -4860000., 3960000.},
		{loc(), 37.89038, 126.73316, 23.0, -3014326.6, 4039148.7, 3895863.}}

	for _, v := range allTests {
		lat, lon, h := e1.ToLLA(v.x, v.y, v.z)
		deltaWithin(t, v.loc, lat, v.lat, 1.0)
		deltaWithin(t, v.loc, lon, v.lon, 1.0)
		deltaWithin(t, v.loc, h, v.h, 1.0)
	}
}

type testobjecttoECEF struct {
	loc string
	lat float64
	lon float64
	h   float64
	x   float64
	y   float64
	z   float64
}

func TestToECEF(t *testing.T) {

	e1 := Init("WGS84", Degrees, Meter, LongitudeIsSymmetric, BearingNotSymmetric)

	allTests := []testobjecttoECEF{
		{loc(), 30.2746722, -97.7403306, 0.0, -742507.1, -5462738.5, 3196706.5},
		{loc(), 38.649882, -77.134602, -3261.28, 1110000, -4860000.0, 3960000.0},
		{loc(), 37.89038, 126.73316, 23., -3014326.6, 4039148.7, 3895863.0},
		{loc(), 0.0, 0.0, 0.0, 6.378137e+06, 0.0, 0.0},
		{loc(), 90.0, 0.0, 0.0, 0.0, 0.0, 6356752.0},
		{loc(), -90.0, 0.0, 0.0, 0.0, 0.0, -6356752.0},
		{loc(), 0.0, 90.0, 0.0, 0.0, 6378137.0, 0.0}}

	for _, v := range allTests {
		x, y, z := e1.ToECEF(v.lat, v.lon, v.h)
		deltaWithin(t, v.loc, x, v.x, 10.0)
		deltaWithin(t, v.loc, y, v.y, 10.0)
		deltaWithin(t, v.loc, z, v.z, 10.0)
	}

}

type testobjectdisplace struct {
	loc  string
	lat1 float64
	lon1 float64
	lat2 float64
	lon2 float64
	x    float64
	y    float64
}

func TestDisplacement(t *testing.T) {
	e1 := Init("WGS84", Degrees, Meter, LongitudeIsSymmetric, BearingNotSymmetric)
	epsilon := 0.00001

	// These tests are taken from the test suite of Geo::Ellipsoid.
	allTests := []testobjectdisplace{
		{loc(), 41.978744444444, 272.096858333333, 42.005419444444, 272.073286111111, -1952.8108885261, 2963.14446772882},
		{loc(), 41.978744444444, 272.096858333333, 42.005419444444, 272.073286111111, -1952.8108885261, 2963.14446772882},
		{loc(), 42.005419444444, 272.073286111111, 42.005508333333, 272.100791666667, 2278.65964147511, 10.239209526501},
		{loc(), 32.895950000000, 262.962800000000, 32.878894444444, 262.969919444444, 666.242452218363, -1891.48052028485},
		{loc(), 32.895950000000, 262.962800000000, 32.878894444444, 262.969919444444, 666.242452218363, -1891.48052028485},
		{loc(), 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0, 0},
		{loc(), 90.000000000000, 0.000000000000, 90.000000000000, 0.000000000000, 0, 0},
		{loc(), 0.000000000000, 90.000000000000, 0.000000000000, 90.000000000000, 0, 0},
		{loc(), 0.000000000000, 89.000000000000, 0.000000000000, 89.000000000000, 0, 0},
		{loc(), 359.000000000000, 90.000000000000, 359.000000000000, 90.000000000000, 0, 0},
		{loc(), 0.000000000000, 270.000000000000, 0.000000000000, 270.000000000000, 0, 0},
		{loc(), 1.000000000000, 270.000000000000, 1.000000000000, 270.000000000000, 0, 0},
		{loc(), 0.000000000000, 0.000000000000, 90.000000000000, 0.000000000000, 0, 10001965.7293115},
		{loc(), 0.000000000000, 0.000000000000, 0.000000000000, 90.000000000000, 10018754.1713946, 6.13451500783715e-010},
		{loc(), 0.000000000000, 0.000000000000, 0.000000000000, 89.000000000000, 9907434.68060135, 6.06635372997229e-010},
		{loc(), 0.000000000000, 0.000000000000, 359.000000000000, 90.000000000000, 10017233.3562517, -174267.647160926},
		{loc(), 0.000000000000, 0.000000000000, 0.000000000000, 270.000000000000, -10018754.1713946, -1.84035450235114e-009},
		{loc(), 0.000000000000, 0.000000000000, 1.000000000000, 270.000000000000, -10017233.3562517, 174267.647160918},
		{loc(), 90.000000000000, 0.000000000000, 0.000000000000, 90.000000000000, 10001965.7293115, -1.60845898969725e-009},
		{loc(), 90.000000000000, 0.000000000000, 0.000000000000, 89.000000000000, 10000442.3814853, -174558.371079727},
		{loc(), 90.000000000000, 0.000000000000, 359.000000000000, 90.000000000000, 10112540.1178694, -1.62624093117951e-009},
		{loc(), 90.000000000000, 0.000000000000, 0.000000000000, 270.000000000000, -10001965.7293115, -1.83727061742428e-009},
		{loc(), 90.000000000000, 0.000000000000, 1.000000000000, 270.000000000000, -9891391.34075357, -1.81695910260457e-009},
		{loc(), 0.000000000000, 90.000000000000, 0.000000000000, 89.000000000000, -111319.490793274, -2.04483833594572e-011},
		{loc(), 0.000000000000, 90.000000000000, 359.000000000000, 90.000000000000, 1.3541009879804e-011, -110574.388557909},
		{loc(), 0.000000000000, 90.000000000000, 0.000000000000, 270.000000000000, 19903593.3909346, 1.21870334652178e-009},
		{loc(), 0.000000000000, 90.000000000000, 1.000000000000, 270.000000000000, 1.40036636629034e-007, 19893357.0700651},
		{loc(), 0.000000000000, 89.000000000000, 359.000000000000, 90.000000000000, 111308.2624725, -110580.03995007},
		{loc(), 0.000000000000, 89.000000000000, 0.000000000000, 270.000000000000, -19926188.851996, -3.66026062134283e-009},
		{loc(), 0.000000000000, 89.000000000000, 1.000000000000, 270.000000000000, -11043413.4548764, 16507054.4447066},
		{loc(), 359.000000000000, 90.000000000000, 0.000000000000, 270.000000000000, 1.43786956706851e-007, -19893357.0700651},
		{loc(), 359.000000000000, 90.000000000000, 1.000000000000, 270.000000000000, 19903623.5599665, 1816.95093116103},
		{loc(), 0.000000000000, 270.000000000000, 1.000000000000, 270.000000000000, 0, 110574.388557909},
	}

	for _, v := range allTests {
		x, y := e1.Displacement(v.lat1, v.lon1, v.lat2, v.lon2)
		deltaWithin(t, v.loc, x, v.x, epsilon)
		deltaWithin(t, v.loc, y, v.y, epsilon)
	}
}
